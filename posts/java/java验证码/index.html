<!DOCTYPE html>
<html><head>
<title>Java验证码</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="Java验证码" />
<meta property="og:description" content="Utility.java import org.apache.commons.lang3.StringUtils; import org.apache.commons.logging.Log; import org.apache.commons.logging.LogFactory; import java.math.BigDecimal; import java.text.SimpleDateFormat; import java.util.*; public class Utility { protected final static Log logger = LogFactory.getLog(Utility.class); public static &lt;T&gt; List&lt;T&gt; newArray(int size, Class&lt;T&gt; clazz) { List&lt;T&gt; l = new ArrayList&lt;T&gt;(); for (int i = 0; i &lt; size; i&#43;&#43;) { T newInstance; try { newInstance = clazz.newInstance(); } catch (Exception e) { newInstance = null; } l.add(newInstance); } return l; } public static String randomString(int len, int type) { StringBuffer str = new StringBuffer(); // 默认去掉了容易混淆的字符oOLlI，要添加请使用addChars参数 String codestr = &#34;ABCDEFGHJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz&#34;; String codeNum = &#34;0123456789&#34;; //	switch (type) { //	case 0: //	codestr = &#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#34;; //	break; //	case 1: //	codestr = &#34;0123456789&#34;; //	break; //	case 2: //	codestr = &#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;; //	break; //	case 3: //	codestr = &#34;abcdefghijklmnopqrstuvwxyz&#34;; //	break; //	default: //	// 默认去掉了容易混淆的字符oOLl和数字01，要添加请使用addChars参数 //	codestr = &#34;ABCDEFGHIJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789&#34;; //	break; //	} char[] codes = codestr." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://brandykk.gitee.io/posts/java/java%E9%AA%8C%E8%AF%81%E7%A0%81/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-20T13:58:34+08:00" />
<meta property="article:modified_time" content="2021-06-20T13:58:34+08:00" /><meta property="og:site_name" content="白小生" />





<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java验证码"/>
<meta name="twitter:description" content="Utility.java import org.apache.commons.lang3.StringUtils; import org.apache.commons.logging.Log; import org.apache.commons.logging.LogFactory; import java.math.BigDecimal; import java.text.SimpleDateFormat; import java.util.*; public class Utility { protected final static Log logger = LogFactory.getLog(Utility.class); public static &lt;T&gt; List&lt;T&gt; newArray(int size, Class&lt;T&gt; clazz) { List&lt;T&gt; l = new ArrayList&lt;T&gt;(); for (int i = 0; i &lt; size; i&#43;&#43;) { T newInstance; try { newInstance = clazz.newInstance(); } catch (Exception e) { newInstance = null; } l.add(newInstance); } return l; } public static String randomString(int len, int type) { StringBuffer str = new StringBuffer(); // 默认去掉了容易混淆的字符oOLlI，要添加请使用addChars参数 String codestr = &#34;ABCDEFGHJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz&#34;; String codeNum = &#34;0123456789&#34;; //	switch (type) { //	case 0: //	codestr = &#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#34;; //	break; //	case 1: //	codestr = &#34;0123456789&#34;; //	break; //	case 2: //	codestr = &#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;; //	break; //	case 3: //	codestr = &#34;abcdefghijklmnopqrstuvwxyz&#34;; //	break; //	default: //	// 默认去掉了容易混淆的字符oOLl和数字01，要添加请使用addChars参数 //	codestr = &#34;ABCDEFGHIJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789&#34;; //	break; //	} char[] codes = codestr."/>










  






      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<link rel="stylesheet" href="/scss/journal.min.c5d92f380bf10f6849c7ac487c7df2b22c081e0851e5339224f1ae29210b20d2.css" integrity="sha256-xdkvOAvxD2hJx6xIfH3ysiwIHghR5TOSJPGuKSELINI=" media="screen">



<link rel="stylesheet" href="/scss/dark-mode.min.9f8d8c2df9285089d141edd4a50cb7506c7948e6ab79a29968dced1bd0ab7d22.css" integrity="sha256-n42MLfkoUInRQe3UpQy3UGx5SOareaKZaNztG9CrfSI=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://brandykk.gitee.io">
    
        <div class="nav-title">
            Brandy
        </div>
        
        <div class="nav-subtitle">
            个人使用
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This is a customized copyright.
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#utilityjava" onclick="onNavClick(`#utilityjava-nav`)" id="utilityjava-nav">
									Utility.java
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#imageutiljava" onclick="onNavClick(`#imageutiljava-nav`)" id="imageutiljava-nav">
									ImageUtil.java
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%aa%8c%e8%af%81%e7%a0%81%e8%b0%83%e7%94%a8%e6%96%b9%e6%b3%95%e5%b9%b6%e8%bf%94%e5%9b%9e" onclick="onNavClick(`#验证码调用方法并返回-nav`)" id="验证码调用方法并返回-nav">
									验证码调用方法并返回
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#utilityjava" onclick="onNavClick(`#utilityjava-nav`)" id="utilityjava-nav">
									Utility.java
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#imageutiljava" onclick="onNavClick(`#imageutiljava-nav`)" id="imageutiljava-nav">
									ImageUtil.java
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%aa%8c%e8%af%81%e7%a0%81%e8%b0%83%e7%94%a8%e6%96%b9%e6%b3%95%e5%b9%b6%e8%bf%94%e5%9b%9e" onclick="onNavClick(`#验证码调用方法并返回-nav`)" id="验证码调用方法并返回-nav">
									验证码调用方法并返回
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://brandykk.gitee.io">
            Brandy
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://brandykk.gitee.io">
        <div class="single-column-header-title">Brandy</div>
        
        <div class="single-column-header-subtitle">个人使用</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    Java验证码
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-06-20 13:58
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/%E5%BC%80%E5%8F%91">开发</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">java</a>
                                &nbsp;
                            
                        
                        
                            <i class="material-icons" style="">schedule</i>
                            

                            
                            

                            
                            9 min
                            
                            58 s.
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="utilityjava">Utility.java</h2>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">org.apache.commons.lang3.StringUtils</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">org.apache.commons.logging.Log</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">org.apache.commons.logging.LogFactory</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.math.BigDecimal</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.text.SimpleDateFormat</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.util.*</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">Utility</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">protected</span> <span style="color:#8b008b;font-weight:bold">final</span> <span style="color:#8b008b;font-weight:bold">static</span> Log logger = LogFactory.<span style="color:#658b00">getLog</span>(Utility.<span style="color:#658b00">class</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> &lt;T&gt; List&lt;T&gt; <span style="color:#008b45">newArray</span>(<span style="color:#00688b;font-weight:bold">int</span> size, Class&lt;T&gt; clazz) {
</span></span><span style="display:flex;"><span>		List&lt;T&gt; l = <span style="color:#8b008b;font-weight:bold">new</span> ArrayList&lt;T&gt;();
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; size; i++) {
</span></span><span style="display:flex;"><span>			T newInstance;
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>				newInstance = clazz.<span style="color:#658b00">newInstance</span>();
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>				newInstance = <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			l.<span style="color:#658b00">add</span>(newInstance);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">return</span> l;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> String <span style="color:#008b45">randomString</span>(<span style="color:#00688b;font-weight:bold">int</span> len, <span style="color:#00688b;font-weight:bold">int</span> type) {
</span></span><span style="display:flex;"><span>		StringBuffer str = <span style="color:#8b008b;font-weight:bold">new</span> StringBuffer();
</span></span><span style="display:flex;"><span>		<span style="color:#228b22">// 默认去掉了容易混淆的字符oOLlI，要添加请使用addChars参数
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>		String codestr = <span style="color:#cd5555">&#34;ABCDEFGHJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz&#34;</span>;
</span></span><span style="display:flex;"><span>		String codeNum = <span style="color:#cd5555">&#34;0123456789&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#228b22">//		switch (type) {
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//		case 0:
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			codestr = &#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			break;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//		case 1:
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			codestr = &#34;0123456789&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			break;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//		case 2:
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			codestr = &#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			break;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//		case 3:
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			codestr = &#34;abcdefghijklmnopqrstuvwxyz&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			break;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//		default:
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			// 默认去掉了容易混淆的字符oOLl和数字01，要添加请使用addChars参数
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			codestr = &#34;ABCDEFGHIJKMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//			break;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//		}
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>		<span style="color:#00688b;font-weight:bold">char</span>[] codes = codestr.<span style="color:#658b00">toCharArray</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#00688b;font-weight:bold">char</span>[] codeNums = codeNum.<span style="color:#658b00">toCharArray</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; len/<span style="color:#b452cd">2</span>; i++) {
</span></span><span style="display:flex;"><span>			<span style="color:#00688b;font-weight:bold">int</span> r = (<span style="color:#00688b;font-weight:bold">int</span>) (Math.<span style="color:#658b00">random</span>() * codestr.<span style="color:#658b00">length</span>());
</span></span><span style="display:flex;"><span>			str.<span style="color:#658b00">append</span>(codes[r]);
</span></span><span style="display:flex;"><span>			<span style="color:#00688b;font-weight:bold">int</span> n = (<span style="color:#00688b;font-weight:bold">int</span>) (Math.<span style="color:#658b00">random</span>()*codeNum.<span style="color:#658b00">length</span>());
</span></span><span style="display:flex;"><span>			str.<span style="color:#658b00">append</span>(n);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		List&lt;String&gt; list=Arrays.<span style="color:#658b00">asList</span>(str.<span style="color:#658b00">toString</span>().<span style="color:#658b00">split</span>(<span style="color:#cd5555">&#34;&#34;</span>));
</span></span><span style="display:flex;"><span>		Collections.<span style="color:#658b00">shuffle</span>(list);
</span></span><span style="display:flex;"><span>		StringBuffer str1 = <span style="color:#8b008b;font-weight:bold">new</span> StringBuffer();
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">for</span>(String s:list){
</span></span><span style="display:flex;"><span>			str1.<span style="color:#658b00">append</span>(s);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">return</span> str1.<span style="color:#658b00">toString</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> String <span style="color:#008b45">randomString</span>(<span style="color:#00688b;font-weight:bold">int</span> length) {
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">return</span> randomString(length, -<span style="color:#b452cd">1</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">int</span> <span style="color:#008b45">random</span>(<span style="color:#00688b;font-weight:bold">int</span> number) {
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">return</span> (<span style="color:#00688b;font-weight:bold">int</span>) (Math.<span style="color:#658b00">random</span>() * number);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> Random random = <span style="color:#8b008b;font-weight:bold">new</span> Random();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">int</span> <span style="color:#008b45">random</span>(<span style="color:#00688b;font-weight:bold">int</span> total, <span style="color:#00688b;font-weight:bold">int</span> count) {
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (count == <span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> total;
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (count == <span style="color:#b452cd">0</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#b452cd">0</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#00688b;font-weight:bold">int</span> average = total / count;
</span></span><span style="display:flex;"><span>		<span style="color:#00688b;font-weight:bold">double</span> d = random.<span style="color:#658b00">nextGaussian</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (d &lt; -<span style="color:#b452cd">0.75</span>)
</span></span><span style="display:flex;"><span>			d = -<span style="color:#b452cd">0.75</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (d &lt; -<span style="color:#b452cd">1</span> + <span style="color:#b452cd">1.0</span> / count)
</span></span><span style="display:flex;"><span>			d = -<span style="color:#b452cd">1</span> + <span style="color:#b452cd">1.0</span> / count;
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (d &gt; <span style="color:#b452cd">4</span>)
</span></span><span style="display:flex;"><span>			d = <span style="color:#b452cd">4</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (d &gt; count - <span style="color:#b452cd">0.1</span>)
</span></span><span style="display:flex;"><span>			d = count - <span style="color:#b452cd">0.1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">return</span> (<span style="color:#00688b;font-weight:bold">int</span>) (d * average + average);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> String <span style="color:#008b45">toString</span>(Object o) {
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (o == <span style="color:#8b008b;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		Class c = o.<span style="color:#658b00">getClass</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (c == Integer.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> Integer.<span style="color:#658b00">toString</span>((Integer) o);
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Float.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> Float.<span style="color:#658b00">toString</span>((Float) o);
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Long.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> Long.<span style="color:#658b00">toString</span>((Long) o);
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Double.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> Double.<span style="color:#658b00">toString</span>((Double) o);
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == BigDecimal.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> o.<span style="color:#658b00">toString</span>();
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Boolean.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> Boolean.<span style="color:#658b00">toString</span>((Boolean) o);
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Date.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>			SimpleDateFormat sdf = <span style="color:#8b008b;font-weight:bold">new</span> SimpleDateFormat(<span style="color:#cd5555">&#34;yyyy-MM-dd HH:mm:ss&#34;</span>);
</span></span><span style="display:flex;"><span>			String ss = sdf.<span style="color:#658b00">format</span>(o);
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> ss;
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> o.<span style="color:#658b00">toString</span>();
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#707a7c">@SuppressWarnings</span>(<span style="color:#cd5555">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> &lt;T&gt; T <span style="color:#008b45">toObject</span>(String str, Class&lt;T&gt; c) {
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (str == <span style="color:#8b008b;font-weight:bold">null</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>			str = str.<span style="color:#658b00">trim</span>();
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">if</span> (c == String.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) str;
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isBlank</span>(str)) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Integer.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) (Integer) Integer.<span style="color:#658b00">parseInt</span>(str);
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Long.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) (Long) Long.<span style="color:#658b00">parseLong</span>(str);
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Byte.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) <span style="color:#8b008b;font-weight:bold">new</span> Byte((<span style="color:#00688b;font-weight:bold">byte</span>) Integer.<span style="color:#658b00">parseInt</span>(str, <span style="color:#b452cd">16</span>));
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Float.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) (Float) Float.<span style="color:#658b00">parseFloat</span>(str);
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Double.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) (Double) Double.<span style="color:#658b00">parseDouble</span>(str);
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Boolean.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">if</span>(<span style="color:#cd5555">&#34;1&#34;</span>.<span style="color:#658b00">equals</span>(str))
</span></span><span style="display:flex;"><span>					<span style="color:#8b008b;font-weight:bold">return</span> (T)Boolean.<span style="color:#658b00">TRUE</span>;
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) (Boolean) Boolean.<span style="color:#658b00">parseBoolean</span>(str);
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == BigDecimal.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) <span style="color:#8b008b;font-weight:bold">new</span> BigDecimal(str);
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (c == Date.<span style="color:#658b00">class</span>) {
</span></span><span style="display:flex;"><span>				SimpleDateFormat sdf = <span style="color:#8b008b;font-weight:bold">new</span> SimpleDateFormat(<span style="color:#cd5555">&#34;yyyy-MM-dd HH:mm:ss&#34;</span>);
</span></span><span style="display:flex;"><span>				Date ss = sdf.<span style="color:#658b00">parse</span>(str);
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) ss;
</span></span><span style="display:flex;"><span>			} <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">return</span> (T) str;
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>			<span style="color:#228b22">// 打印异常信息，例当一个非常长的数字字符串转Integer时，若没有意识到Integer数字大小限制时，没有异常输出，难于找到原因。非常不利问题的解决
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>			logger.<span style="color:#658b00">debug</span>(<span style="color:#cd5555">&#34;对象转换异常，调试用&#34;</span>, e);
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#228b22">// 列举排序
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> &lt;T&gt; List&lt;T&gt; <span style="color:#008b45">sort</span>(Enumeration&lt;T&gt; enumer) {
</span></span><span style="display:flex;"><span>		List&lt;T&gt; l = <span style="color:#8b008b;font-weight:bold">new</span> ArrayList&lt;T&gt;();
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">while</span> (enumer.<span style="color:#658b00">hasMoreElements</span>()) {
</span></span><span style="display:flex;"><span>			T t = (T) enumer.<span style="color:#658b00">nextElement</span>();
</span></span><span style="display:flex;"><span>			l.<span style="color:#658b00">add</span>(t);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		Collections.<span style="color:#658b00">sort</span>((List) l);
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">return</span> l;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#228b22">// 列表排序
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> &lt;T&gt; List&lt;T&gt; <span style="color:#008b45">sort</span>(List&lt;T&gt; l) {
</span></span><span style="display:flex;"><span>		Collections.<span style="color:#658b00">sort</span>((List) l);
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">return</span> l;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> String <span style="color:#008b45">substring</span>(String str, <span style="color:#00688b;font-weight:bold">int</span> from, <span style="color:#00688b;font-weight:bold">int</span> to) {
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (from &gt;= str.<span style="color:#658b00">length</span>())
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (from &lt; <span style="color:#b452cd">0</span>)
</span></span><span style="display:flex;"><span>			from = <span style="color:#b452cd">0</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (to &lt; <span style="color:#b452cd">0</span> || to &gt; str.<span style="color:#658b00">length</span>())
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> str.<span style="color:#658b00">substring</span>(from);
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">return</span> str.<span style="color:#658b00">substring</span>(from, to);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">//	public static void main(String[] args) {
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//		String in = randomString(4);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//		System.out.println(in);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//	}
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- raw HTML omitted -->
<h2 id="imageutiljava">ImageUtil.java</h2>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">lombok.extern.slf4j.Slf4j</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">org.jeecg.common.util.IOCloseUtil</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">javax.imageio.ImageIO</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.awt.*</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.awt.geom.AffineTransform</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.awt.image.BufferedImage</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.io.File</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.io.FileOutputStream</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.io.IOException</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.io.OutputStream</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.util.Arrays</span>;
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">java.util.Random</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">ImageUtil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//使用到Algerian字体，系统里没有的话需要安装字体，字体只显示大写，去掉了1,0,i,o几个容易混淆的字符
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#8b008b;font-weight:bold">final</span> String VERIFY_CODES = <span style="color:#cd5555">&#34;23456789ABCDEFGHJKLMNPQRSTUVWXYZ&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> Random random = <span style="color:#8b008b;font-weight:bold">new</span> Random();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * 使用系统默认字符源生成验证码
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param verifySize 验证码长度
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> String <span style="color:#008b45">generateVerifyCode</span>(<span style="color:#00688b;font-weight:bold">int</span> verifySize) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> generateVerifyCode(verifySize, VERIFY_CODES);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * 使用指定源生成验证码
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param verifySize 验证码长度
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param sources    验证码字符源
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> String <span style="color:#008b45">generateVerifyCode</span>(<span style="color:#00688b;font-weight:bold">int</span> verifySize, String sources) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (sources == <span style="color:#8b008b;font-weight:bold">null</span> || sources.<span style="color:#658b00">length</span>() == <span style="color:#b452cd">0</span>) {
</span></span><span style="display:flex;"><span>            sources = VERIFY_CODES;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> codesLen = sources.<span style="color:#658b00">length</span>();
</span></span><span style="display:flex;"><span>        Random rand = <span style="color:#8b008b;font-weight:bold">new</span> Random(System.<span style="color:#658b00">currentTimeMillis</span>());
</span></span><span style="display:flex;"><span>        StringBuilder verifyCode = <span style="color:#8b008b;font-weight:bold">new</span> StringBuilder(verifySize);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; verifySize; i++) {
</span></span><span style="display:flex;"><span>            verifyCode.<span style="color:#658b00">append</span>(sources.<span style="color:#658b00">charAt</span>(rand.<span style="color:#658b00">nextInt</span>(codesLen - <span style="color:#b452cd">1</span>)));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> verifyCode.<span style="color:#658b00">toString</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * 生成随机验证码文件,并返回验证码值
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param w
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param h
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param outputFile
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param verifySize
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @throws IOException
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">//    public static String outputVerifyImage(int w, int h, File outputFile, int verifySize) throws IOException {
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//        String verifyCode = generateVerifyCode(verifySize);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//        outputImage(w, h, outputFile, verifyCode);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//        return verifyCode;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//    }
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * 输出随机验证码图片流,并返回验证码值
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param w
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param h
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param os
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param verifySize
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @throws IOException
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">//    public static String outputVerifyImage(int w, int h, OutputStream os, int verifySize) throws IOException {
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//        String verifyCode = generateVerifyCode(verifySize);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//        outputImage(w, h, os, verifyCode);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//        return verifyCode;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//    }
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * 生成指定验证码图像文件
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param w
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param h
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param outputFile
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param code
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @throws IOException
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">outputImage</span>(<span style="color:#00688b;font-weight:bold">int</span> w, <span style="color:#00688b;font-weight:bold">int</span> h, File outputFile, String code) <span style="color:#8b008b;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (outputFile == <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        File dir = outputFile.<span style="color:#658b00">getParentFile</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (!dir.<span style="color:#658b00">exists</span>()) {
</span></span><span style="display:flex;"><span>            dir.<span style="color:#658b00">mkdirs</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            outputFile.<span style="color:#658b00">createNewFile</span>();
</span></span><span style="display:flex;"><span>            FileOutputStream fos = <span style="color:#8b008b;font-weight:bold">new</span> FileOutputStream(outputFile);
</span></span><span style="display:flex;"><span>            outputImage(w, h, fos, code);
</span></span><span style="display:flex;"><span>            IOCloseUtil.<span style="color:#658b00">close</span>(fos);
</span></span><span style="display:flex;"><span>        } <span style="color:#8b008b;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">throw</span> e;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * 输出指定验证码图片流
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param w
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param h
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param os
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @param code
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @throws IOException
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">outputImage</span>(<span style="color:#00688b;font-weight:bold">int</span> w, <span style="color:#00688b;font-weight:bold">int</span> h, OutputStream os, String code) <span style="color:#8b008b;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> verifySize = code.<span style="color:#658b00">length</span>();
</span></span><span style="display:flex;"><span>        BufferedImage image = <span style="color:#8b008b;font-weight:bold">new</span> BufferedImage(w, h, BufferedImage.<span style="color:#658b00">TYPE_INT_RGB</span>);
</span></span><span style="display:flex;"><span>        Random rand = <span style="color:#8b008b;font-weight:bold">new</span> Random();
</span></span><span style="display:flex;"><span>        Graphics2D g2 = image.<span style="color:#658b00">createGraphics</span>();
</span></span><span style="display:flex;"><span>        g2.<span style="color:#658b00">setRenderingHint</span>(RenderingHints.<span style="color:#658b00">KEY_ANTIALIASING</span>, RenderingHints.<span style="color:#658b00">VALUE_ANTIALIAS_ON</span>);
</span></span><span style="display:flex;"><span>        Color[] colors = <span style="color:#8b008b;font-weight:bold">new</span> Color[<span style="color:#b452cd">5</span>];
</span></span><span style="display:flex;"><span>        Color[] colorSpaces = <span style="color:#8b008b;font-weight:bold">new</span> Color[]{Color.<span style="color:#658b00">WHITE</span>, Color.<span style="color:#658b00">CYAN</span>,
</span></span><span style="display:flex;"><span>                Color.<span style="color:#658b00">GRAY</span>, Color.<span style="color:#658b00">LIGHT_GRAY</span>, Color.<span style="color:#658b00">MAGENTA</span>, Color.<span style="color:#658b00">ORANGE</span>,
</span></span><span style="display:flex;"><span>                Color.<span style="color:#658b00">PINK</span>, Color.<span style="color:#658b00">YELLOW</span>};
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">float</span>[] fractions = <span style="color:#8b008b;font-weight:bold">new</span> <span style="color:#00688b;font-weight:bold">float</span>[colors.<span style="color:#658b00">length</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; colors.<span style="color:#658b00">length</span>; i++) {
</span></span><span style="display:flex;"><span>            colors[i] = colorSpaces[rand.<span style="color:#658b00">nextInt</span>(colorSpaces.<span style="color:#658b00">length</span>)];
</span></span><span style="display:flex;"><span>            fractions[i] = rand.<span style="color:#658b00">nextFloat</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Arrays.<span style="color:#658b00">sort</span>(fractions);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        g2.<span style="color:#658b00">setColor</span>(Color.<span style="color:#658b00">GRAY</span>);<span style="color:#228b22">// 设置边框色
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        g2.<span style="color:#658b00">fillRect</span>(<span style="color:#b452cd">0</span>, <span style="color:#b452cd">0</span>, w, h);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Color c = getRandColor(<span style="color:#b452cd">200</span>, <span style="color:#b452cd">250</span>);
</span></span><span style="display:flex;"><span>        g2.<span style="color:#658b00">setColor</span>(c);<span style="color:#228b22">// 设置背景色
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        g2.<span style="color:#658b00">fillRect</span>(<span style="color:#b452cd">0</span>, <span style="color:#b452cd">2</span>, w, h - <span style="color:#b452cd">4</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">//绘制干扰线
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        Random random = <span style="color:#8b008b;font-weight:bold">new</span> Random();
</span></span><span style="display:flex;"><span>        g2.<span style="color:#658b00">setColor</span>(getRandColor(<span style="color:#b452cd">160</span>, <span style="color:#b452cd">200</span>));<span style="color:#228b22">// 设置线条的颜色
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; <span style="color:#b452cd">20</span>; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">int</span> x = random.<span style="color:#658b00">nextInt</span>(w - <span style="color:#b452cd">1</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">int</span> y = random.<span style="color:#658b00">nextInt</span>(h - <span style="color:#b452cd">1</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">int</span> xl = random.<span style="color:#658b00">nextInt</span>(<span style="color:#b452cd">6</span>) + <span style="color:#b452cd">1</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">int</span> yl = random.<span style="color:#658b00">nextInt</span>(<span style="color:#b452cd">12</span>) + <span style="color:#b452cd">1</span>;
</span></span><span style="display:flex;"><span>            g2.<span style="color:#658b00">drawLine</span>(x, y, x + xl + <span style="color:#b452cd">40</span>, y + yl + <span style="color:#b452cd">20</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// 添加噪点
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#00688b;font-weight:bold">float</span> yawpRate = <span style="color:#b452cd">0.05f</span>;<span style="color:#228b22">// 噪声率
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#00688b;font-weight:bold">int</span> area = (<span style="color:#00688b;font-weight:bold">int</span>) (yawpRate * w * h);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; area; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">int</span> x = random.<span style="color:#658b00">nextInt</span>(w);
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">int</span> y = random.<span style="color:#658b00">nextInt</span>(h);
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">int</span> rgb = getRandomIntColor();
</span></span><span style="display:flex;"><span>            image.<span style="color:#658b00">setRGB</span>(x, y, rgb);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        shear(g2, w, h, c);<span style="color:#228b22">// 使图片扭曲
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>        g2.<span style="color:#658b00">setColor</span>(getRandColor(<span style="color:#b452cd">100</span>, <span style="color:#b452cd">160</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> fontSize = h - <span style="color:#b452cd">4</span>;
</span></span><span style="display:flex;"><span>        Font font = <span style="color:#8b008b;font-weight:bold">new</span> Font(<span style="color:#cd5555">&#34;Algerian&#34;</span>, Font.<span style="color:#658b00">ITALIC</span>, fontSize);
</span></span><span style="display:flex;"><span>        g2.<span style="color:#658b00">setFont</span>(font);
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">char</span>[] chars = code.<span style="color:#658b00">toCharArray</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; verifySize; i++) {
</span></span><span style="display:flex;"><span>            AffineTransform affine = <span style="color:#8b008b;font-weight:bold">new</span> AffineTransform();
</span></span><span style="display:flex;"><span>            affine.<span style="color:#658b00">setToRotation</span>(Math.<span style="color:#658b00">PI</span> / <span style="color:#b452cd">4</span> * rand.<span style="color:#658b00">nextDouble</span>() * (rand.<span style="color:#658b00">nextBoolean</span>() ? <span style="color:#b452cd">1</span> : -<span style="color:#b452cd">1</span>), (w / verifySize) * i + fontSize / <span style="color:#b452cd">2</span>, h / <span style="color:#b452cd">2</span>);
</span></span><span style="display:flex;"><span>            g2.<span style="color:#658b00">setTransform</span>(affine);
</span></span><span style="display:flex;"><span>            g2.<span style="color:#658b00">drawChars</span>(chars, i, <span style="color:#b452cd">1</span>, ((w - <span style="color:#b452cd">10</span>) / verifySize) * i + <span style="color:#b452cd">5</span>, h / <span style="color:#b452cd">2</span> + fontSize / <span style="color:#b452cd">2</span> - <span style="color:#b452cd">10</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        g2.<span style="color:#658b00">dispose</span>();
</span></span><span style="display:flex;"><span>        ImageIO.<span style="color:#658b00">write</span>(image, <span style="color:#cd5555">&#34;png&#34;</span>, os);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> Color <span style="color:#008b45">getRandColor</span>(<span style="color:#00688b;font-weight:bold">int</span> fc, <span style="color:#00688b;font-weight:bold">int</span> bc) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (fc &gt; <span style="color:#b452cd">255</span>) {
</span></span><span style="display:flex;"><span>            fc = <span style="color:#b452cd">255</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (bc &gt; <span style="color:#b452cd">255</span>) {
</span></span><span style="display:flex;"><span>            bc = <span style="color:#b452cd">255</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> r = fc + random.<span style="color:#658b00">nextInt</span>(bc - fc);
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> g = fc + random.<span style="color:#658b00">nextInt</span>(bc - fc);
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> b = fc + random.<span style="color:#658b00">nextInt</span>(bc - fc);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">new</span> Color(r, g, b);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">int</span> <span style="color:#008b45">getRandomIntColor</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span>[] rgb = getRandomRgb();
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> color = <span style="color:#b452cd">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> c : rgb) {
</span></span><span style="display:flex;"><span>            color = color &lt;&lt; <span style="color:#b452cd">8</span>;
</span></span><span style="display:flex;"><span>            color = color | c;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> color;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">int</span>[] <span style="color:#008b45">getRandomRgb</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span>[] rgb = <span style="color:#8b008b;font-weight:bold">new</span> <span style="color:#00688b;font-weight:bold">int</span>[<span style="color:#b452cd">3</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; <span style="color:#b452cd">3</span>; i++) {
</span></span><span style="display:flex;"><span>            rgb[i] = random.<span style="color:#658b00">nextInt</span>(<span style="color:#b452cd">255</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> rgb;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">shear</span>(Graphics g, <span style="color:#00688b;font-weight:bold">int</span> w1, <span style="color:#00688b;font-weight:bold">int</span> h1, Color color) {
</span></span><span style="display:flex;"><span>        shearX(g, w1, h1, color);
</span></span><span style="display:flex;"><span>        shearY(g, w1, h1, color);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">shearX</span>(Graphics g, <span style="color:#00688b;font-weight:bold">int</span> w1, <span style="color:#00688b;font-weight:bold">int</span> h1, Color color) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> period = random.<span style="color:#658b00">nextInt</span>(<span style="color:#b452cd">2</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">boolean</span> borderGap = <span style="color:#8b008b;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> frames = <span style="color:#b452cd">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> phase = random.<span style="color:#658b00">nextInt</span>(<span style="color:#b452cd">2</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; h1; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">double</span> d = (<span style="color:#00688b;font-weight:bold">double</span>) (period &gt;&gt; <span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span>                    * Math.<span style="color:#658b00">sin</span>((<span style="color:#00688b;font-weight:bold">double</span>) i / (<span style="color:#00688b;font-weight:bold">double</span>) period
</span></span><span style="display:flex;"><span>                    + (<span style="color:#b452cd">6.2831853071795862D</span> * (<span style="color:#00688b;font-weight:bold">double</span>) phase)
</span></span><span style="display:flex;"><span>                    / (<span style="color:#00688b;font-weight:bold">double</span>) frames);
</span></span><span style="display:flex;"><span>            g.<span style="color:#658b00">copyArea</span>(<span style="color:#b452cd">0</span>, i, w1, <span style="color:#b452cd">1</span>, (<span style="color:#00688b;font-weight:bold">int</span>) d, <span style="color:#b452cd">0</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">if</span> (borderGap) {
</span></span><span style="display:flex;"><span>                g.<span style="color:#658b00">setColor</span>(color);
</span></span><span style="display:flex;"><span>                g.<span style="color:#658b00">drawLine</span>((<span style="color:#00688b;font-weight:bold">int</span>) d, i, <span style="color:#b452cd">0</span>, i);
</span></span><span style="display:flex;"><span>                g.<span style="color:#658b00">drawLine</span>((<span style="color:#00688b;font-weight:bold">int</span>) d + w1, i, w1, i);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">shearY</span>(Graphics g, <span style="color:#00688b;font-weight:bold">int</span> w1, <span style="color:#00688b;font-weight:bold">int</span> h1, Color color) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> period = random.<span style="color:#658b00">nextInt</span>(<span style="color:#b452cd">40</span>) + <span style="color:#b452cd">10</span>; <span style="color:#228b22">// 50;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">boolean</span> borderGap = <span style="color:#8b008b;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> frames = <span style="color:#b452cd">20</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#00688b;font-weight:bold">int</span> phase = <span style="color:#b452cd">7</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = <span style="color:#b452cd">0</span>; i &lt; w1; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">double</span> d = (<span style="color:#00688b;font-weight:bold">double</span>) (period &gt;&gt; <span style="color:#b452cd">1</span>)
</span></span><span style="display:flex;"><span>                    * Math.<span style="color:#658b00">sin</span>((<span style="color:#00688b;font-weight:bold">double</span>) i / (<span style="color:#00688b;font-weight:bold">double</span>) period
</span></span><span style="display:flex;"><span>                    + (<span style="color:#b452cd">6.2831853071795862D</span> * (<span style="color:#00688b;font-weight:bold">double</span>) phase)
</span></span><span style="display:flex;"><span>                    / (<span style="color:#00688b;font-weight:bold">double</span>) frames);
</span></span><span style="display:flex;"><span>            g.<span style="color:#658b00">copyArea</span>(i, <span style="color:#b452cd">0</span>, <span style="color:#b452cd">1</span>, h1, <span style="color:#b452cd">0</span>, (<span style="color:#00688b;font-weight:bold">int</span>) d);
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">if</span> (borderGap) {
</span></span><span style="display:flex;"><span>                g.<span style="color:#658b00">setColor</span>(color);
</span></span><span style="display:flex;"><span>                g.<span style="color:#658b00">drawLine</span>(i, (<span style="color:#00688b;font-weight:bold">int</span>) d, i, <span style="color:#b452cd">0</span>);
</span></span><span style="display:flex;"><span>                g.<span style="color:#658b00">drawLine</span>(i, (<span style="color:#00688b;font-weight:bold">int</span>) d + h1, i, h1);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">//    public static void main(String[] args) throws IOException {
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//        for (int i = 0; i &lt; 20; i++) {
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//            File dir = new File(&#34;E:/img/&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//            int w = 200, h = 80;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//            String verifyCode = generateVerifyCode(4);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//            File file = new File(dir, verifyCode + &#34;.jpg&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//            outputImage(w, h, file, verifyCode);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//        }
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">//    }
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!-- raw HTML omitted -->
<h2 id="验证码调用方法并返回">验证码调用方法并返回</h2>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> Result&lt;String&gt; <span style="color:#008b45">verify</span>(HttpServletRequest request, HttpServletResponse response) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Result&lt;String&gt; result = <span style="color:#8b008b;font-weight:bold">new</span> Result&lt;&gt;();
</span></span><span style="display:flex;"><span>		<span style="color:#228b22">// 获取界面传过来的验证码
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>		String securityCode = Utility.<span style="color:#658b00">randomString</span>(<span style="color:#b452cd">4</span>);
</span></span><span style="display:flex;"><span>		ByteArrayOutputStream bos = <span style="color:#8b008b;font-weight:bold">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>			ImageUtil.<span style="color:#658b00">outputImage</span>(<span style="color:#b452cd">107</span>, <span style="color:#b452cd">40</span>, bos, securityCode);
</span></span><span style="display:flex;"><span>			redisUtil.<span style="color:#658b00">set</span>(getVerifyKey(request), securityCode.<span style="color:#658b00">toLowerCase</span>(Locale.<span style="color:#658b00">ENGLISH</span>), <span style="color:#b452cd">1</span> * <span style="color:#b452cd">60</span>);
</span></span><span style="display:flex;"><span>			String verifys = <span style="color:#8b008b;font-weight:bold">new</span> String(Base64.<span style="color:#658b00">encodeBase64</span>(bos.<span style="color:#658b00">toByteArray</span>()));
</span></span><span style="display:flex;"><span>			result.<span style="color:#658b00">setResult</span>(verifys);
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">catch</span> (JeecgBootException e) {
</span></span><span style="display:flex;"><span>			e.<span style="color:#658b00">printStackTrace</span>();
</span></span><span style="display:flex;"><span>			result.<span style="color:#658b00">error500</span>(<span style="color:#cd5555">&#34;生成验证码失败&#34;</span>);
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>			e.<span style="color:#658b00">printStackTrace</span>();
</span></span><span style="display:flex;"><span>			result.<span style="color:#658b00">error500</span>(<span style="color:#cd5555">&#34;生成验证码失败&#34;</span>);
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#8b008b;font-weight:bold">if</span> (bos != <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>					bos.<span style="color:#658b00">close</span>();
</span></span><span style="display:flex;"><span>				} <span style="color:#8b008b;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>					e.<span style="color:#658b00">printStackTrace</span>();
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">private</span> String <span style="color:#008b45">getVerifyKey</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>		<span style="color:#228b22">// return request.getRequestedSessionId() + &#34;_Verify&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>		String ipAddrByRequest = IPUtils.<span style="color:#658b00">getIpAddr</span>(request);
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">if</span> (ipAddrByRequest.<span style="color:#658b00">contains</span>(<span style="color:#cd5555">&#34;.&#34;</span>)) {
</span></span><span style="display:flex;"><span>			ipAddrByRequest = ipAddrByRequest.<span style="color:#658b00">replace</span>(<span style="color:#cd5555">&#34;.&#34;</span>, <span style="color:#cd5555">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>		} <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (ipAddrByRequest.<span style="color:#658b00">contains</span>(<span style="color:#cd5555">&#34;:&#34;</span>)) {
</span></span><span style="display:flex;"><span>			ipAddrByRequest = ipAddrByRequest.<span style="color:#658b00">replace</span>(<span style="color:#cd5555">&#34;:&#34;</span>, <span style="color:#cd5555">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;Verify_&#34;</span> + ipAddrByRequest;
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><!-- raw HTML omitted -->

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2021-06-20</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/%E9%9D%A2%E8%AF%95%E9%A2%98/">
			下回<br>Java面试题
                </a>
                
                
                
                <a class="older-posts" href="/posts/java/jdk1.8/">
			上回<br>Jdk1.8
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This is a customized copyright.
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
